import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BkCxzhY_.js";import{t as D,s as b}from"./firestore.2zEXouMz.js";import{u as F}from"./useAuth.3kjH0eSx.js";import{S as P}from"./search.CKHZE96q.js";import{C as v}from"./calendar.DZHq-396.js";import{P as L}from"./plus.CYIN8ATd.js";import{S as A,T as E}from"./trash-2.DrzUQVgL.js";import{X as R}from"./x.Ovrnmcvi.js";import"./index.DEhT-VCm.js";import"./config.DNoymYbc.js";import"./createLucideIcon.28FQD8iY.js";const Y=()=>{const{user:d}=F(),[m,n]=o.useState("schedule"),[u,p]=o.useState(new Date().toISOString().split("T")[0]),[U,$]=o.useState(""),[h,f]=o.useState(""),[c,j]=o.useState([]),[y,N]=o.useState(!0),[x,g]=o.useState([]);o.useEffect(()=>{(async()=>{try{console.log("🔥 ObservationScheduler: Starting to fetch teachers from Firestore...");const a=await D.getAll();console.log("🔥 ObservationScheduler: Fetched teachers from Firestore:",a);const l=a.map(t=>({id:t.id,name:t.name,subject:t.subjects.join(", "),grade:t.grade||"N/A",room:t.currentClass?.room||"N/A",email:t.email,schedule:{"Period 1":{time:"8:00-8:45",class:t.currentClass?.name||"Class"},"Period 2":{time:"8:50-9:35",class:t.currentClass?.name||"Class"},"Period 3":{time:"9:40-10:25",class:t.currentClass?.name||"Class"},"Period 4":{time:"10:45-11:30",class:t.currentClass?.name||"Class"},"Period 5":{time:"11:35-12:20",class:t.currentClass?.name||"Class"},"Period 6":{time:"1:05-1:50",class:t.currentClass?.name||"Class"},"Period 7":{time:"1:55-2:40",class:t.currentClass?.name||"Class"}},availability:"medium",lastObservation:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0]}));j(l),console.log("🔥 ObservationScheduler: Successfully set teachers:",l)}catch(a){console.error("❌ ObservationScheduler: Error fetching teachers:",a),alert("Failed to load teachers. Check console for details.")}finally{N(!1)}})()},[]),o.useEffect(()=>{(async()=>{try{console.log("🔥 ObservationScheduler: Fetching scheduled observations from Firestore...");const a=await b.getAll();console.log("🔥 ObservationScheduler: Fetched scheduled observations:",a);const l=a.map(t=>({id:t.id,teacherId:t.teacherId,teacherName:t.teacherName,date:t.date,time:new Date(t.startTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!1}).replace(":","")+"-"+new Date(new Date(t.startTime).getTime()+45*6e4).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!1}).replace(":",""),period:t.classInfo.period||"Period",class:t.classInfo.name,room:t.classInfo.room,observer:t.observerName,status:t.status,notes:t.overallComment||"",framework:t.frameworkId,duration:t.duration,priority:"normal"}));g(l),console.log("🔥 ObservationScheduler: Successfully set scheduled observations:",l)}catch(a){console.error("❌ ObservationScheduler: Error fetching scheduled observations:",a)}})()},[]);const[r,i]=o.useState({teacherId:"",date:"",period:"",time:"",class:"",notes:"",framework:"CRP + All Frameworks",duration:15,priority:"normal"}),w=c.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.subject.toLowerCase().includes(h.toLowerCase())||s.grade.toLowerCase().includes(h.toLowerCase())),S=s=>{switch(s){case"high":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=s=>{switch(s){case"high":return"High - Ready for observation";case"medium":return"Medium - Recent observation";case"low":return"Low - Overdue for observation";default:return"Unknown"}},O=async()=>{if(!r.teacherId||!r.date||!r.period){alert("Please fill in all required fields");return}const s=c.find(l=>l.id===r.teacherId),a=s?.schedule[r.period];if(!s||!a){alert("Selected teacher or period not found.");return}try{const l={teacherId:r.teacherId,teacherName:s.name,observerId:d?.id||"test-observer",observerName:d?.name||d?.email||"Test Observer",frameworkId:r.framework.toLowerCase().replace(/\s+/g,"-"),date:r.date,startTime:new Date(`${r.date} ${a.time.split("-")[0]}`).toISOString(),status:"scheduled",duration:r.duration||15,responses:{},comments:{},overallComment:r.notes,classInfo:{name:a.class,subject:s.subject,room:s.room,period:r.period,grade:s.grade}};console.log("🔥 ObservationScheduler: Creating observation in Firestore...",l);const t=await b.create(l);console.log("🔥 ObservationScheduler: Successfully created observation with ID:",t);const T={id:t,teacherId:r.teacherId,teacherName:s.name,date:r.date,time:a.time,period:r.period,class:a.class,room:s.room,observer:d?.name||d?.email||"Test Observer",status:"scheduled",notes:r.notes,framework:r.framework,duration:r.duration,priority:r.priority};g([...x,T]),console.log("🔥 ObservationScheduler: Added observation to local state"),i({teacherId:"",date:"",period:"",time:"",class:"",notes:"",framework:"CRP + All Frameworks",duration:15,priority:"normal"}),n("schedule"),alert("Observation Scheduled Successfully in Firestore!")}catch(l){console.error("❌ ObservationScheduler: Error scheduling observation:",l);const t=l instanceof Error?l.message:"Unknown error";alert(`Error scheduling observation: ${t}. Check console for details.`)}},k=async s=>{try{await b.cancel(s),g(x.filter(a=>a.id!==s)),alert("Observation cancelled successfully")}catch(a){console.error("Error cancelling observation:",a),alert("Error cancelling observation")}},I=s=>{console.log("Starting observation:",s.id),sessionStorage.setItem("currentObservationData",JSON.stringify(s)),window.location.href="/observe"};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Observation Scheduler"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage and schedule classroom observations"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>n("schedule"),className:`px-4 py-2 rounded-lg font-medium ${m==="schedule"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Schedule View"}),e.jsx("button",{onClick:()=>n("create"),className:`px-4 py-2 rounded-lg font-medium ${m==="create"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Schedule New"})]})]})})}),e.jsxs("div",{className:"px-6 py-6",children:[m==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Date"}),e.jsx("input",{type:"date",value:u,onChange:s=>p(s.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Teachers"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, subject, or grade...",value:h,onChange:s=>f(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Scheduled for ",new Date(u).toLocaleDateString()]})}),e.jsx("div",{className:"p-6",children:x.filter(s=>s.date===u).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No observations scheduled"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Schedule your first observation for this date"}),e.jsxs("button",{onClick:()=>n("create"),className:"bg-blue-500 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 hover:bg-blue-600 mx-auto",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Schedule Observation"})]})]}):e.jsx("div",{className:"space-y-4",children:x.filter(s=>s.date===u).map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.teacherName}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:s.period})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",s.time]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Class:"})," ",s.class]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Room:"})," ",s.room]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Observer:"})," ",s.observer]})]}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Framework Focus:"})," ",s.framework]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>I(s),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 text-sm font-medium",children:"Start Observation"}),e.jsx("button",{onClick:()=>n("edit"),className:"text-gray-600 hover:text-gray-900 p-2",title:"Edit Observation",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k(s.id),className:"text-red-600 hover:text-red-900 p-2",title:"Cancel Observation",children:e.jsx(E,{className:"w-4 h-4"})})]})]})},s.id))})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:["Teacher Availability",y&&e.jsxs("span",{className:"ml-3 text-sm text-gray-600 flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading..."]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.subject," • ",s.grade]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Room ",s.room]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S(s.availability)}`,children:s.availability.toUpperCase()})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Last observed: ",new Date(s.lastObservation).toLocaleDateString()]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:C(s.availability)}),e.jsx("button",{onClick:()=>{i({...r,teacherId:s.id}),n("create")},className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm font-medium",children:"Schedule Observation"})]},s.id))})})]})]}),m==="create"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Schedule New Observation"}),e.jsx("button",{onClick:()=>n("schedule"),className:"text-gray-600 hover:text-gray-900",children:e.jsx(R,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teacher *"}),e.jsxs("select",{value:r.teacherId,onChange:s=>i({...r,teacherId:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a teacher..."}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.subject," (",s.grade,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:r.date,onChange:s=>i({...r,date:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),r.teacherId&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class Period *"}),e.jsxs("select",{value:r.period,onChange:s=>i({...r,period:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a period..."}),Object.entries(c.find(s=>s.id===r.teacherId)?.schedule||{}).map(([s,a])=>e.jsxs("option",{value:s,children:[s," (",a.time,") - ",a.class]},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Framework Focus"}),e.jsxs("select",{value:r.framework,onChange:s=>i({...r,framework:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CRP + All Frameworks",children:"CRP + All Frameworks (Standard)"}),e.jsx("option",{value:"CRP Focus",children:"CRP Focus Only"}),e.jsx("option",{value:"Tripod 7Cs",children:"Tripod 7Cs Focus"}),e.jsx("option",{value:"CASEL + SEL",children:"CASEL + SEL Focus"}),e.jsx("option",{value:"5 Daily Assessment",children:"5 Daily Assessment Focus"}),e.jsx("option",{value:"Inclusive Practices",children:"Inclusive Practices Focus"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes)"}),e.jsxs("select",{value:r.duration,onChange:s=>i({...r,duration:parseInt(s.target.value)}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10 minutes (Quick Check)"}),e.jsx("option",{value:15,children:"15 minutes (Standard)"}),e.jsx("option",{value:20,children:"20 minutes (Extended)"}),e.jsx("option",{value:30,children:"30 minutes (Full Period)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority Level"}),e.jsxs("select",{value:r.priority,onChange:s=>i({...r,priority:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High (Overdue for observation)"}),e.jsx("option",{value:"urgent",children:"Urgent (Support needed)"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observation Notes"}),e.jsx("textarea",{value:r.notes,onChange:s=>i({...r,notes:s.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24 resize-none",placeholder:"Optional notes about focus areas, special considerations, or goals for this observation..."})]}),r.teacherId&&r.period&&e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Observation Preview"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Teacher:"})," ",c.find(s=>s.id===r.teacherId)?.name??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Class:"})," ",c.find(s=>s.id===r.teacherId)?.schedule[r.period]?.class??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",c.find(s=>s.id===r.teacherId)?.schedule[r.period]?.time??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Room:"})," ",c.find(s=>s.id===r.teacherId)?.room??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(r.date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",r.duration," minutes"]}),r.notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",r.notes]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Framework Focus:"})," ",r.framework]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Priority:"})," ",r.priority]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>n("schedule"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium",children:"Cancel"}),e.jsxs("button",{onClick:O,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:"Schedule Observation"})]})]})]})]})]})]})};export{Y as default};
