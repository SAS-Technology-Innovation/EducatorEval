import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.BkCxzhY_.js";import{g as I}from"./index.CRLXNNgt.js";import{u as C,f as v}from"./useObservations.D46LKL6D.js";import{u as O}from"./useAuth.3kjH0eSx.js";import{S as D}from"./save.BK5mzEY7.js";import{c as T}from"./createLucideIcon.28FQD8iY.js";import"./index.DEhT-VCm.js";import"./firestore.2zEXouMz.js";import"./config.DNoymYbc.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],F=T("send",E),_=()=>{const{user:n}=O(),{createObservation:h}=C(),[c,x]=d.useState("crp-in-action"),[t,m]=d.useState({teacher:"",teacherId:"",subject:"",className:"",room:"",period:"",grade:"",duration:30,responses:{},comments:{},overallComment:""}),[A,P]=d.useState(0),[i,j]=d.useState([]),[b,U]=d.useState(v.getFrameworkOptions()),[u,g]=d.useState(!1);d.useEffect(()=>{const s=v.getObservationQuestions(c);j(s.map(r=>({id:r.id,text:r.text,type:r.type,scale:r.scale,frameworkAlignments:r.frameworkAlignments})))},[c]),d.useEffect(()=>{const s=sessionStorage.getItem("newObservationData");if(console.log("Stored Data:",s),s)try{const r=JSON.parse(s);m(a=>({...a,teacher:r.teacher,teacherId:r.teacherId,subject:r.subject,className:r.className,room:r.room,period:r.period,grade:r.grade})),console.log("Parsed Data:",r),x(r.framework||"crp-in-action"),sessionStorage.removeItem("newObservationData")}catch(r){console.error("Error loading observation data from session storage:",r)}},[]);const p=[{id:"teacher1",name:"Sarah Johnson",currentClass:{name:"Biology - Period 2",subject:"Biology",room:"A108",period:"Period 2",grade:"10th Grade"}},{id:"teacher2",name:"David Chen",currentClass:{name:"World History - Period 4",subject:"World History",room:"B112",period:"Period 4",grade:"9th Grade"}}],f=(s,r)=>{m(a=>({...a,responses:{...a.responses,[s]:r}}))},y=(s,r)=>{m(a=>({...a,comments:{...a.comments,[s]:r}}))},w=async()=>{if(!(!n||!t.teacherId)){g(!0);try{const s={};Object.entries(t.responses).forEach(([a,l])=>{s[a]={questionId:a,value:l,timestamp:new Date().toISOString()}});const r={teacherId:t.teacherId,teacherName:t.teacher,observerId:n.id,observerName:n.name||n.email||"Unknown Observer",frameworkId:c,date:new Date().toISOString().split("T")[0],startTime:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),endTime:new Date(Date.now()+t.duration*6e4).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),duration:t.duration,status:"draft",responses:s,comments:t.comments,overallComment:t.overallComment,classInfo:{subject:t.subject,name:t.className,room:t.room,period:t.period,grade:t.grade}};await h(r),alert("Draft saved successfully!")}catch(s){console.error("Error saving draft:",s),alert("Failed to save draft. Please try again.")}finally{g(!1)}}},N=async()=>{if(!(!n||!t.teacherId)){g(!0);try{const s={};Object.entries(t.responses).forEach(([a,l])=>{s[a]={questionId:a,value:l,timestamp:new Date().toISOString()}});const r={teacherId:t.teacherId,teacherName:t.teacher,observerId:n.id,observerName:n.name||n.email||"Unknown Observer",frameworkId:c,date:new Date().toISOString().split("T")[0],startTime:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),endTime:new Date(Date.now()+t.duration*6e4).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),duration:t.duration,status:"completed",responses:s,comments:t.comments,overallComment:t.overallComment,classInfo:{subject:t.subject,name:t.className,room:t.room,period:t.period,grade:t.grade}};await h(r),alert("Observation submitted successfully!"),window.location.href="/data"}catch(s){console.error("Error submitting observation:",s),alert("Failed to submit observation. Please try again.")}finally{g(!1)}}},S=s=>{const r=t.responses[s.id]||"",a=t.comments[s.id]||"";switch(s.type){case"rating":const l=["4","3","2","1","not-observed"];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-5 gap-2",children:l.map(o=>e.jsx("button",{onClick:()=>f(s.id,o),className:`py-2 px-3 text-sm rounded border text-center ${r===o?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:border-blue-300"}`,children:o==="not-observed"?"N/O":o},o))}),e.jsx("textarea",{placeholder:"Add evidence/notes...",value:a,onChange:o=>y(s.id,o.target.value),className:"w-full p-3 border border-gray-300 rounded text-sm",rows:3})]});case"text":return e.jsx("textarea",{placeholder:"Enter your response...",value:r,onChange:o=>f(s.id,o.target.value),className:"w-full p-3 border border-gray-300 rounded text-sm",rows:4});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Teacher"}),e.jsxs("select",{value:t.teacherId,onChange:s=>{const r=p.find(a=>a.id===s.target.value);r&&m(a=>({...a,teacherId:r.id,teacher:r.name,subject:r.currentClass?.subject||"",className:r.currentClass?.name||"",room:r.currentClass?.room||"",period:r.currentClass?.period||"",grade:r.currentClass?.grade||""}))},className:"w-full text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"Select teacher..."}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.teacherId&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Subject"}),e.jsx("div",{className:"text-sm text-gray-900",children:t.subject})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Room"}),e.jsx("div",{className:"text-sm text-gray-900",children:t.room})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Framework"}),e.jsx("select",{value:c,onChange:s=>x(s.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1",children:b.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))})]})]})}),e.jsxs("div",{className:"px-4 py-6 space-y-6",children:[i.map((s,r)=>{const a=t.responses[s.id]||"";return e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 leading-tight pr-2",children:[r+1,". ",s.text]}),e.jsx("div",{className:"flex items-center space-x-2 flex-shrink-0",children:a&&e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a==="4"?"bg-green-100 text-green-800":a==="3"?"bg-blue-100 text-blue-800":a==="2"?"bg-yellow-100 text-yellow-800":a==="1"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a==="not-observed"?"N/O":a})})]}),s.frameworkAlignments&&s.frameworkAlignments.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-blue-50 rounded text-xs",children:[e.jsx("strong",{className:"text-blue-800",children:"Frameworks:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.frameworkAlignments.map(l=>{const o=b.find(k=>k.id===l);return o?e.jsx("span",{className:`px-2 py-1 rounded text-xs ${I(o.color)}`,children:o.label},l):null})})]})]}),S(s),e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:a?"Completed":"Pending"})]})]},s.id)}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Overall Comments"}),e.jsx("textarea",{placeholder:"Add overall observation notes...",value:t.overallComment,onChange:s=>m(r=>({...r,overallComment:s.target.value})),className:"w-full p-3 border border-gray-300 rounded text-sm",rows:4})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Progress"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Object.keys(t.responses).length,"/",i.length," completed"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${i.length>0?Object.keys(t.responses).length/i.length*100:0}%`}})}),t.teacherId&&Object.keys(t.responses).length<i.length&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[i.length-Object.keys(t.responses).length," look-fors remaining to complete observation."]})}),e.jsxs("div",{className:"flex space-x-3 mt-4",children:[e.jsxs("button",{disabled:!t.teacherId||u,onClick:w,className:"flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium flex items-center justify-center space-x-2 disabled:opacity-50",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:u?"Saving...":"Save Draft"})]}),e.jsxs("button",{disabled:!t.teacherId||Object.keys(t.responses).length===0||u,onClick:N,className:"flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium flex items-center justify-center space-x-2 disabled:opacity-50 disabled:bg-gray-400",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:u?"Submitting...":"Submit"})]})]})]})]})]})};export{_ as default};
